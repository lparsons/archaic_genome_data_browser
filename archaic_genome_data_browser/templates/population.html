{% extends "base.html" %}

{% block app_content %}
    <h2>{{ population.code}}: {{ population.name }}</h2>
    <p>{{ population.description }}</p>
    <p>Population Groups:</p>
        {% for super_population in population.super_populations %}
            <p><a href="{{ url_for('main.super_population', id=super_population.id) }}">
                {{ super_population.code }}: {{ super_population.name }}</a> - {{ super_population.data_source.name }}</p>
        {% endfor %}

    <h3>Archaic Genome Data</h3>
    <table class="table table-hover">
        <tr>
            <th>Run</th>
            <th>Samples with data</th>
            <th>Avg Neadertal BPs</th>
            <th>Avg Neadertal Haplotypes</th>
            <th>Avg Denisovan BPs</th>
            <th>Avg Denisovan Haplotypes</th>
        </tr>
        {% for archaic_analysis_run in population.archaic_analysis_runs %}
        {% set avg_archaic_genome_stats = population.avg_archaic_genome_stats(archaic_analysis_run.id) %}
            <tr>
                <td><a href="{{ url_for('main.archaic_analysis_run', id=archaic_analysis_run.id) }}">{{ archaic_analysis_run.name }}</a></td>
                <td>{{ population.samples_with_data_for_run(archaic_analysis_run.id) |  length }}</td>
                <td>{% if avg_archaic_genome_stats['neandertal_bp_avg'] %}{{ "{:,.0f}".format(avg_archaic_genome_stats['neandertal_bp_avg']) }}{% endif %}</td>
                <td>{% if avg_archaic_genome_stats['neandertal_haplotypes_avg'] %}{{ "{:,.0f}".format(avg_archaic_genome_stats['neandertal_haplotypes_avg']) }}{% endif %}</td>
                <td>{% if avg_archaic_genome_stats['denisovan_bp_avg'] %}{{ "{:,.0f}".format(avg_archaic_genome_stats['denisovan_bp_avg']) }}{% endif %}</td>
                <td>{% if avg_archaic_genome_stats['denisovan_haplotypes_avg'] %}{{ "{:,.0f}".format(avg_archaic_genome_stats['denisovan_haplotypes_avg']) }}{% endif %}</td>
            </tr>
        {% endfor %}
    </table>

    <h3>Samples ({{ population.sample_count }})</h3>
    <table class="table table-hover">
        <tr>
            <th>Sample</th>
            <th>Family ID</th>
            <th>Gender</th>
            <th>Family Relationship</th>
            <th>Other Comments</th>
        </tr>
        {% for sample in population.samples %}
            <tr>
                <td><a href="{{ url_for('main.sample', id=sample.id)}}">{{ sample.code }}</a></td>
                <td><a href="">{{ sample.family_code }}</a></td>
                <td>{{ sample.gender }}</td>
                <td>{{ sample.family_relationship }}</td>
                <td>{{ sample.comments }}</td>
            </tr>
        {% endfor %}
    </table>
{% endblock %}
