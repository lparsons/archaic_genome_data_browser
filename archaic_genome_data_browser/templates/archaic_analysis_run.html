{% extends "base.html" %}

{% block app_content %}
    <h2>{{ archaic_analysis_run.name}}</h2>
    {% if archaic_analysis_run.description %}
        <p>{{ archaic_analysis_run.description }}
    {% endif %}
    {% if archaic_analysis_run.publication_doi %}
        <a href="{{ archaic_analysis_run.publication_url }}">{{ archaic_analysis_run.publication_doi }}</a>
    {% endif %}
    </td>
    <h3>Populations with run data</h3>
    <table class="table table-hover">
        <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Description</th>
            <th>Samples with run data</th>
            <th>Avg Neadertal BPs</th>
            <th>Avg Neadertal Haplotypes</th>
            <th>Avg Denisovan BPs</th>
            <th>Avg Denisovan Haplotypes</th>
        </tr>
        {% for population in populations %}
        {% set avg_archaic_genome_stats = population.avg_archaic_genome_stats(archaic_analysis_run.id) %}
            <tr>
                <td><a href="{{ url_for('main.population', id=population.id)}}">{{ population.code }}</a></td>
                <td><a href="{{ url_for('main.population', id=population.id)}}">{{ population.name }}</a></td>
                <td><a href="{{ url_for('main.population', id=population.id)}}">{{ population.description }}</a></td>
                <td>{{ population.samples_with_data_for_run(archaic_analysis_run.id) | length }}</td>
                <td>{% if avg_archaic_genome_stats['neandertal_bp_avg'] %}{{ "{:,.0f}".format(avg_archaic_genome_stats['neandertal_bp_avg']) }}{% endif %}</td>
                <td>{% if avg_archaic_genome_stats['neandertal_haplotypes_avg'] %}{{ "{:,.0f}".format(avg_archaic_genome_stats['neandertal_haplotypes_avg']) }}{% endif %}</td>
                <td>{% if avg_archaic_genome_stats['denisovan_bp_avg'] %}{{ "{:,.0f}".format(avg_archaic_genome_stats['denisovan_bp_avg']) }}{% endif %}</td>
                <td>{% if avg_archaic_genome_stats['denisovan_haplotypes_avg'] %}{{ "{:,.0f}".format(avg_archaic_genome_stats['denisovan_haplotypes_avg']) }}{% endif %}</td>
            </tr>
        {% endfor %}
    </table>
{% endblock %}
